<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
</head>
<body>

<div data-role="page" id="pageone">
  <div data-role="header">
    <h1>Search Doctor</h1>
  </div>

  <div data-role="main" class="ui-content">
    <form>
    <label for="name">Name:</label>
    <input type="text" name="name" id="name_doctor" value="">
    <label>Hospital:</label>
    <a id="select_hospital" class="ui-shadow ui-btn ui-corner-all ui-icon-arrow-r ui-btn-icon-right">Select hospital</a>
    <label>Faculity:</label>
    <a id="select_faculty" data-theme="a" class="ui-shadow ui-btn ui-corner-all ui-icon-arrow-r ui-btn-icon-right">Select faculty</a>
    <a id="search_doctor" data-theme="a" class="ui-btn ui-icon-search ui-btn-icon-right ui-corner-all" >Search</a>
	</form>
  </div>
</div>

<div data-role="page" id="pagetwo">
  <div data-role="header">
    <h1>Select Hospital</h1>
  </div>

  <div data-role="main" class="ui-content">
    <div id="hospital_div">
    </div>
  </div>

 <input type="button" id="save_hospital" name="save_hospital" value="Save" />
</div>

<div data-role="page" id="pagethree">
  <div data-role="header">
    <h1>Select Faculty</h1>
  </div>

  <div data-role="main" class="ui-content">
    <div id="faculty_div">
    </div>
  </div>

 <input type="button" id="save_faculty" name="save_faculty" value="Save" />
</div>

<div data-role="page" id="pagefour">
  <div data-role="header">
 <a id="search_again" class="ui-btn ui-corner-all ui-shadow ui-icon-search ui-btn-icon-left" data-theme="a">Search</a>
    <h1>List Doctor</h1>
  </div>

  <div data-role="main" class="ui-content">
        <ul data-role="listview" data-filter="true"  id="listview_doctor" data-theme="a">
        </ul>
  </div>

</div>

<script>
function getJson(){
$.getJSON("http://pacce7.site11.com/hospital/get_hospital.php", function(data)
{
var record = data.hospitals;
 for (var i = 0; i < record.length; i++)
  {
    var object = record[i];
    $("#hospital_div").append('<label><input type="checkbox" name="'+object.Name+'" class="class_checkd" value="'+object.Value+'">'+object.Name+'</label>');
  }
});

$.getJSON("http://pacce7.site11.com/hospital/get_faculty.php", function(data)
{
var record = data.facultys;
 for (var i = 0; i < record.length; i++)
  {
    var object = record[i];
    $("#faculty_div").append('<label><input type="checkbox" name="'+object.Name+'" class="class_checkf" value="'+object.Value+'">'+object.Name+'</label>');
  }
});

    return 1;
}
var resultGetJson = getJson();
$('#select_hospital').click(function(){
    window.location = "#pagetwo"
});

$('#select_faculty').click(function(){
  window.location = "#pagethree"
});
</script>

<script>
$('#save_hospital').click(function(){
    var final = '';
    $('.class_checkd:checked').each(function(){        
        var values = $(this).val();
        if (final != "") { final += ","}
        final += values;
    });
    window.location = "#pageone"
});

$('#save_faculty').click(function(){
    var final = '';
    $('.class_checkf:checked').each(function(){        
        var values = $(this).val();
        if (final != "") { final += ","}
        final += values;
    });
    window.location = "#pageone"
});

$('#search_again').click(function(){
    $("#listview_doctor").empty();
    window.location = "#pageone"
    location.reload();
});

$('#search_doctor').click(function(){
    var check_hospital = '';
   $('.class_checkd:checked').each(function(){        
        var values = $(this).val();
        if (check_hospital != "") { check_hospital += ","}
        check_hospital += values;
    });
    var check_faculty = '';
    $('.class_checkf:checked').each(function(){        
        var values = $(this).val();
        if (check_faculty != "") { check_faculty += ","}
        check_faculty += values;
});

    var name_doctor = $("#name_doctor").val();
$.ajax({url: 'http://pacce7.site11.com/hospital/search_doctor.php',
                    data: {action : 'search_doctor', name : name_doctor, hospital: check_hospital, faculty:check_faculty},
                    type: 'post',                  
                    async: 'true',
                    dataType: 'json',
                    beforeSend: function() {
                        // This callback function will trigger before data is sent
                    },
                    complete: function() {
                        window.location = "#pagefour";
						 $('#listview_doctor').listview('refresh');
                    },
                    success: function (result) {
                        if(result.status) {
						var record = JSON.parse(result.result);
						 for (var i = 0; i < record.length; i++)
						 {
							var object = record[i];
							$('#listview_doctor').append('<li><a><img src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/7a02e010328017.560e316093fb7.png" /> <h1> ' + object.Name + '</h1><p> '+object.Hospital+'</p></a></li>');
						  }
                        } else {
                            alert('Login unsuccessful!');
                        }
                    },
                    error: function (request,error) {
                        // This callback function will trigger on unsuccessful action               
                        alert('Network error has occurred please try again!');
                    }
                });        

});
</script>
</body>
</html>